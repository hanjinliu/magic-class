
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Generate multifunctional and macro recordable GUIs from Python classes">
      
      
      
      
        <link rel="prev" href="../confirm/">
      
      
        <link rel="next" href="../icon/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>Multi-threading - magic-class</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-threading" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="magic-class" class="md-header__button md-logo" aria-label="magic-class" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            magic-class
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Multi-threading
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hanjinliu/magic-class" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    magic-class
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="magic-class" class="md-nav__button md-logo" aria-label="magic-class" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    magic-class
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hanjinliu/magic-class" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    magic-class
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../basics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Options in magic-class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Fields in magic-class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/nest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nest magic-classes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/tooltips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set Tooltips
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use magicproperty in magic-class
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Make Your GUI Better
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Make Your GUI Better
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../location/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Call Parent Methods from its Child
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../keybinding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Keybindings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../undo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implement Undo/Redo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bind/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binding Values to Arguments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../choices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set Choices Dynamically
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validation/Normalization for Macro Recording
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Complicated Settings of Dialogs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Preview Functionalities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../confirm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre-run Confirmation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Multi-threading
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Multi-threading
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Connect Callbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#better-way-to-define-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Better Way to Define Callbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-progress-bar" class="md-nav__link">
    <span class="md-ellipsis">
      Use Progress Bar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Progress Bar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-it" class="md-nav__link">
    <span class="md-ellipsis">
      How to use it?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-set-proper-total-iteration-numbers" class="md-nav__link">
    <span class="md-ellipsis">
      How to set proper total iteration numbers?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-way-to-pass-progress-bar-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Better way to pass progress bar parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nesting-thread_worker" class="md-nav__link">
    <span class="md-ellipsis">
      Nesting thread_worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nesting thread_worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-naive-solution" class="md-nav__link">
    <span class="md-ellipsis">
      A naive solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-but-advanced-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Better but advanced solution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asynchronous-valuewidget-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Asynchronous ValueWidget Callbacks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../icon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set Custom Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging in magic-class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../additional_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Container Variations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing Magic classes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../visualization/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Data Visualization
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Data Visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/matplotlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matplotlib Figure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/pyqtgraph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyQtGraph Canvas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/vispy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vispy Canvas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/vtk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VTK (Visualization Toolkit)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../advanced/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced Topics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/freewidget/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Convert QtWidgets into a Magic Widget
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/customize_macro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customize Macro Recording
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/inheritance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inherit Magic Class
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../best_practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best Practice
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API References
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    magicclass.core
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Connect Callbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#better-way-to-define-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Better Way to Define Callbacks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-progress-bar" class="md-nav__link">
    <span class="md-ellipsis">
      Use Progress Bar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Progress Bar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-it" class="md-nav__link">
    <span class="md-ellipsis">
      How to use it?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-set-proper-total-iteration-numbers" class="md-nav__link">
    <span class="md-ellipsis">
      How to set proper total iteration numbers?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-way-to-pass-progress-bar-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Better way to pass progress bar parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nesting-thread_worker" class="md-nav__link">
    <span class="md-ellipsis">
      Nesting thread_worker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nesting thread_worker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-naive-solution" class="md-nav__link">
    <span class="md-ellipsis">
      A naive solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-but-advanced-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Better but advanced solution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asynchronous-valuewidget-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Asynchronous ValueWidget Callbacks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="multi-threading">Multi-threading</h1>
<p>Multi-threading is an important idea in GUI development. If you want to implement
background execution or progress bar, you'll usually have to rely on multi-threading.</p>
<p><code>thread_worker</code> makes multi-threaded implementation much easier, without rewriting the
existing single-threaded code. It is available in:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is named after the <code>thread_worker</code> function originally defined in <code>superqt</code> and <code>napari</code>, which create a new function that will return a "worker" of the original
function.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">napari.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@thread_worker</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="c1"># do something</span>

<span class="n">worker</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>  <span class="c1"># worker is ready to run the original &quot;func&quot;</span>
<span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># the original &quot;func&quot; actually get called</span>
</code></pre></div>
<p>On the other hand, <code>magic-class</code>'s <code>thread_worker</code> is a class. It returns a
<code>thread_worker</code> object instead of a new function. A <code>thread_worker</code> object will
create a function that will start a worker every time it is accessed via
<code>self.func</code>. Although they are designed differently, they share very similar API.</p>
</div>
<h2 id="basic-usage">Basic Usage</h2>
<p>Decorate the methods you want to be multi-threaded and that's it!</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">magicclass</span> <span class="kn">import</span> <span class="n">magicclass</span>
<span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># time consuming function</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="../../_images/workers-0.png" /></p>
<p>During execution of <code>func</code>, the GUI window will not get frozen because
function is running in another thread.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are running functions programatically, GUI window will be disabled as usual.
This is because the <code>run</code> method of <code>QRunnable</code> is called in the main thread,
otherwise the second line of code will be executed <em>before</em> the first line of code
actually finishes.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">f0</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">f1</span><span class="p">()</span>  <span class="c1"># this function will be called before f0 finishes</span>
</code></pre></div>
<p>This behavior is important to keep manual and programatical execution
consistent.</p>
</div>
<p>If decorated method is a generator, worker will iterate over it until it ends. In the
following example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">magicclass</span> <span class="kn">import</span> <span class="n">magicclass</span>
<span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">i</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>after you click the "func" button you'll get output like this.</p>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code>0
1
2
</code></pre></div>
<h2 id="connect-callbacks">Connect Callbacks</h2>
<p>If you update widgets in a <code>thread_worker</code>, GUI crashes.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">magicclass</span> <span class="kn">import</span> <span class="n">magicclass</span><span class="p">,</span> <span class="n">vfield</span>
<span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">yielded_value</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">returned_value</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yielded_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">returned_value</span> <span class="o">=</span> <span class="s2">&quot;finished&quot;</span>  <span class="c1"># updates the widget</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>This is because updating widgets must be done in the main thread but <code>thread_worker</code> is
executed in a separate thread.</p>
<p>Just like <code>superqt</code> and <code>napari</code>, you can connect callback functions to <code>thread_worker</code>
objects. These callback functions are called in the main thread so that you can update
widgets safely.</p>
<p>There are six types of callbacks.</p>
<ul>
<li><code>started</code> ... called when worker started.</li>
<li><code>returned</code> ... called when worker returned some values.</li>
<li><code>errored</code> ... called when worker raised an error.</li>
<li><code>yielded</code> ... called when worker yielded values.</li>
<li><code>finished</code> ... called when worker finished.</li>
<li><code>aborted</code> ... called when worker was aborted by some reasons.</li>
</ul>
<p>Following example shows how you can update widget every 0.3 second.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">magicclass</span> <span class="kn">import</span> <span class="n">magicclass</span><span class="p">,</span> <span class="n">vfield</span>
<span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">yielded_value</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">returned_value</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">yield</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;finished&quot;</span>

    <span class="nd">@func</span><span class="o">.</span><span class="n">yielded</span><span class="o">.</span><span class="n">connect</span>
    <span class="k">def</span> <span class="nf">_on_yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yielded_value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@func</span><span class="o">.</span><span class="n">returned</span><span class="o">.</span><span class="n">connect</span>
    <span class="k">def</span> <span class="nf">_on_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">returned_value</span> <span class="o">=</span> <span class="n">value</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h2 id="better-way-to-define-callbacks">Better Way to Define Callbacks</h2>
<p>The <code>returned</code> callbacks and the <code>yielded</code> callbacks are very useful for letting users
know the progress and results of the function. However, a problem occurs when you send a
lot of information to the callback funcition.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">magicclass</span> <span class="kn">import</span> <span class="n">magicclass</span><span class="p">,</span> <span class="n">vfield</span>
<span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">result_1</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">result_2</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">result_3</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">very_heavy_computation_1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">very_heavy_computation_2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r3</span> <span class="o">=</span> <span class="n">very_heavy_computation_3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r2</span>

    <span class="nd">@func</span><span class="o">.</span><span class="n">returned</span><span class="o">.</span><span class="n">connect</span>
    <span class="k">def</span> <span class="nf">_on_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># hmmm...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_1</span> <span class="o">=</span> <span class="n">r1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_3</span> <span class="o">=</span> <span class="n">r3</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>You'll have to return all the values required for updating the widgets. In terms of
readability, this code is awful. You also have to annotate the second argument of
<code>_on_return</code> with a very long <code>tuple[...]</code> type.</p>
<p>Here, you can use <code>thread_worker.callback</code> static method. This method converts a function into a <code>Callback</code> object, which will be called if a thread worker detected it
as a returned/yielded value.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">magicclass</span> <span class="kn">import</span> <span class="n">magicclass</span><span class="p">,</span> <span class="n">vfield</span>
<span class="kn">from</span> <span class="nn">magicclass.utils</span> <span class="kn">import</span> <span class="n">thread_worker</span>

<span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">result_1</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">result_2</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">result_3</span> <span class="o">=</span> <span class="n">vfield</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">very_heavy_computation_1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">very_heavy_computation_2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r3</span> <span class="o">=</span> <span class="n">very_heavy_computation_3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="c1"># write things in a function</span>
        <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">def</span> <span class="nf">_return_callback</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_1</span> <span class="o">=</span> <span class="n">r1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_2</span> <span class="o">=</span> <span class="n">r2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_3</span> <span class="o">=</span> <span class="n">r3</span>
        <span class="k">return</span> <span class="n">_return_callback</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">def</span> <span class="nf">_yield_callback</span><span class="p">():</span>
            <span class="c1"># r1, r2, r3 are non-local variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_1</span> <span class="o">=</span> <span class="n">r1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_2</span> <span class="o">=</span> <span class="n">r2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_3</span> <span class="o">=</span> <span class="n">r3</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="n">very_heavy_computation_1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">very_heavy_computation_2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">r3</span> <span class="o">=</span> <span class="n">very_heavy_computation_3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">_yield_callback</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">Main</span><span class="p">()</span>
<span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h2 id="use-progress-bar">Use Progress Bar</h2>
<h3 id="how-to-use-it">How to use it?</h3>
<p>Just like <code>napari</code>, you can use the embeded progress bar to display the
progress of the current function call using <code>progress=...</code> argument.
Same options are available in <code>magic-class</code> but you can choose which
progress bar to use.</p>
<ol>
<li>
<p>If the main window does not have <code>magicgui.widgets.ProgressBar</code> widget, a popup
   progress bar widget will be created.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>If the main window has at least one <code>magicgui.widgets.ProgressBar</code> widget, the first
   one will be used.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">pbar</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">ProgressBar</span><span class="p">)</span>
    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>
</li>
<li>
<p>If "pbar" option is given, progress bar specified by this option will be used.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">pbar1</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">ProgressBar</span><span class="p">)</span>
    <span class="n">pbar2</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">ProgressBar</span><span class="p">)</span>

    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;pbar&quot;</span><span class="p">:</span> <span class="n">pbar1</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>
</li>
</ol>
<h3 id="how-to-set-proper-total-iteration-numbers">How to set proper total iteration numbers?</h3>
<p>I most cases, iteration numbers vary between function calls depending on the widget
states. In <code>magic-class</code>, you can pass a function or an evaluable literal string to the
"total" argument.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="c1"># Use a getter function.</span>

    <span class="k">def</span> <span class="nf">_get_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">10</span>

    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">_get_total</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_total</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">yield</span>

    <span class="c1"># Use a literal. Only the function arguments are available in the namespace.</span>

    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="s2">&quot;n_iter&quot;</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">yield</span>

    <span class="c1"># Use a literal. Any evaluable literal can be used.</span>

    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="s2">&quot;width * height&quot;</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">yield</span>
            <span class="nb">print</span><span class="p">()</span>

    <span class="c1"># Use a literal. Of course, &quot;self&quot; is the most powerful way.</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="nd">@thread_worker</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="s2">&quot;self.n.value&quot;</span><span class="p">})</span>
    <span class="k">def</span> <span class="nf">func3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">yield</span>
</code></pre></div>
<h3 id="better-way-to-pass-progress-bar-parameters">Better way to pass progress bar parameters</h3>
<p>Parameteres for the progress bar should be passed as a dictionary. This is not good for
many reasons such as readability and type hinting. You can use <code>with_progress</code> method
for the progress bar configuration.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="c1"># instead of `@thread_worker(progress={&quot;total&quot;: 10})`</span>
    <span class="nd">@thread_worker</span><span class="o">.</span><span class="n">with_progress</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>
<h2 id="nesting-thread_worker">Nesting <code>thread_worker</code></h2>
<p>To reuse thread worker functions, you would want to nest them. However,
this should be done carefully. If the nested thread worker updates the
widget, the outer thread worker crashes the GUI.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">outside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inside</span><span class="p">()</span>  <span class="c1"># This line will crash the GUI, even though</span>
        <span class="c1"># the function that update the widget is in the callback of</span>
        <span class="c1"># `self.inside`.</span>
        <span class="c1"># When a thread worker is called programatically, the function</span>
        <span class="c1"># body and the callbacks are all called in the main thread.</span>
        <span class="c1"># This means that even `self.function_that_update_widget` is</span>
        <span class="c1"># called inside this method.</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">inside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">very_heavy_computation</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_that_update_widget</span><span class="p">)</span>
</code></pre></div>
<h3 id="a-naive-solution">A naive solution</h3>
<p>One way to avoid this is to use <code>thread_worker.callback</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">outside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.inside() will be called as as callback so it won&#39;t crash the GUI</span>
        <span class="k">return</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inside</span><span class="p">)</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">inside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">very_heavy_computation</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">thread_worker</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_that_update_widget</span><span class="p">)</span>
</code></pre></div>
<h3 id="better-but-advanced-solution">Better but advanced solution</h3>
<p>Methods decorated with <code>thread_worker</code> have a <code>arun</code> attribute, which will run the
function in a non-blocking way (asynchronously). More precisely, <code>arun</code> will return a
generator that convert all the yielded and returned value into yielded values. This
means that you can use <code>yield from</code> to send all the callbacks of the nested thread
worker to the outer thread worker.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">outside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># `arun` takes the same arguments as the original function.</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">inside</span><span class="o">.</span><span class="n">arun</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@thread_worker</span>
    <span class="k">def</span> <span class="nf">inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_that_update_widget</span><span class="p">()</span>
</code></pre></div>
<h2 id="asynchronous-valuewidget-callbacks">Asynchronous ValueWidget Callbacks</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature is experimental. It may not work in some cases.</p>
</div>
<p><a href="../../basics/fields/">Fields</a> are equipped with <code>connect</code> method to connect callbacks to
them.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="nd">@x</span><span class="o">.</span><span class="n">connect</span>
    <span class="k">def</span> <span class="nf">_x_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># print the new value every time it changes</span>
</code></pre></div>
<p>Then, what if the callback function is computationally expensive? The GUI will freeze
during the execution, which makes user experience very bad. This problem is prominent
when you want to implement functions like below.</p>
<ul>
<li>Image sweeping ... images are large collections of data. Updating the image while
  moving a slider widget will be very slow.</li>
<li>Data fetching ... Fetching data from the internet is slower compared to updating
  widgets locally.</li>
</ul>
<p><code>connect_async</code> is a method that connects a callback function as a <code>thread_worker</code>
with proper configurations. All the rules follows the standard <code>thread_worker</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">display</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="nd">@x</span><span class="o">.</span><span class="n">connect_async</span>
    <span class="k">def</span> <span class="nf">_x_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># If you want to update the widget, you have to use yield/return</span>
        <span class="c1"># callbacks.</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;updating ...&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;changed to </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@_x_changed</span><span class="o">.</span><span class="n">yielded</span><span class="o">.</span><span class="n">connect</span>
    <span class="nd">@_x_changed</span><span class="o">.</span><span class="n">returned</span><span class="o">.</span><span class="n">connect</span>
    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">text</span>
</code></pre></div>
<p>To avoid running widget callback functions multiple times, you can pass <code>timeout</code>
argument to <code>connect_async</code>. If the previous run is still ongoing, it will be aborted if
the new run is started within the timeout period. <code>timeout=0</code> means that the previous
run will never be aborted, and <code>timeout=float("inf")</code> means that the previous run will
be always aborted if not finished.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@magicclass</span>
<span class="k">class</span> <span class="nc">Main</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="nd">@x</span><span class="o">.</span><span class="n">connect_async</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_x_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="o">...</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2023 - 2024 Hanjin Liu
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.sections", "navigation.indexes", "toc.follow", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>